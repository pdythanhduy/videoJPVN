<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Wrapping Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
            background: #1a1a1a;
            color: white;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-box {
            background: rgba(0,0,0,0.75);
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .jp-text {
            font-size: 11px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        .vi-text {
            font-size: 10px;
            font-weight: 500;
            color: #e5e7eb;
            line-height: 1.4;
        }
        .highlight {
            background: rgba(59, 130, 246, 0.2);
            padding: 8px;
            border-radius: 4px;
        }
        .debug {
            background: #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Text Wrapping Test</h1>
        
        <div class="test-box">
            <h3>Test Case 1: Japanese Text</h3>
            <div class="jp-text">
                「昨日のライブ、やばかった！」と言えば「すごく楽しかった」という意味になります。このように「やばい」は、状況によって良い意味にも悪い意味にもなる、とても便利で感情的な言葉です。
            </div>
        </div>
        
        <div class="test-box">
            <h3>Test Case 2: Vietnamese Text</h3>
            <div class="vi-text">
                Hoặc nói Buổi live hôm qua yabakatta!, thì có nghĩa là rất vui, cực hay. Như vậy, yabai tùy ngữ cảnh có thể mang nghĩa xấu hoặc tốt, là một từ rất tiện dụng và giàu sắc thái cảm xúc.
            </div>
        </div>
        
        <div class="test-box highlight">
            <h3>Test Case 3: Combined (Current Cue)</h3>
            <div class="jp-text">
                「昨日のライブ、やばかった！」と言えば「すごく楽しかった」という意味になります。このように「やばい」は、状況によって良い意味にも悪い意味にもなる、とても便利で感情的な言葉です。
            </div>
            <div class="vi-text">
                Hoặc nói Buổi live hôm qua yabakatta!, thì có nghĩa là rất vui, cực hay. Như vậy, yabai tùy ngữ cảnh có thể mang nghĩa xấu hoặc tốt, là một từ rất tiện dụng và giàu sắc thái cảm xúc.
            </div>
        </div>
        
        <div class="debug">
            <h3>Debug Info:</h3>
            <p>JP Text Length: <span id="jp-length"></span></p>
            <p>VI Text Length: <span id="vi-length"></span></p>
            <p>JP Text Preview: <span id="jp-preview"></span></p>
            <p>VI Text Preview: <span id="vi-preview"></span></p>
        </div>
    </div>

    <script>
        // Test data
        const testData = {
            jp: "「昨日のライブ、やばかった！」と言えば「すごく楽しかった」という意味になります。このように「やばい」は、状況によって良い意味にも悪い意味にもなる、とても便利で感情的な言葉です。",
            vi: "Hoặc nói Buổi live hôm qua yabakatta!, thì có nghĩa là rất vui, cực hay. Như vậy, yabai tùy ngữ cảnh có thể mang nghĩa xấu hoặc tốt, là một từ rất tiện dụng và giàu sắc thái cảm xúc."
        };
        
        // Update debug info
        document.getElementById('jp-length').textContent = testData.jp.length;
        document.getElementById('vi-length').textContent = testData.vi.length;
        document.getElementById('jp-preview').textContent = testData.jp.substring(0, 50) + '...';
        document.getElementById('vi-preview').textContent = testData.vi.substring(0, 50) + '...';
        
        // Test text wrapping function
        function wrapText(text, maxWidth, fontSize) {
            if (!text || text.trim() === '') return [];
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const fontFamily = 'system-ui, -apple-system, Segoe UI, Roboto, Arial';
            ctx.font = `${fontSize}px ${fontFamily}`;
            
            // For Japanese text, split by characters instead of words
            const isJapanese = /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(text);
            
            if (isJapanese) {
                // Japanese text wrapping by characters
                const chars = text.split('');
                const lines = [];
                let currentLine = '';
                
                for (const char of chars) {
                    const testLine = currentLine + char;
                    const metrics = ctx.measureText(testLine);
                    
                    if (metrics.width > maxWidth && currentLine) {
                        lines.push(currentLine);
                        currentLine = char;
                    } else {
                        currentLine = testLine;
                    }
                }
                
                if (currentLine) {
                    lines.push(currentLine);
                }
                
                return lines;
            } else {
                // Vietnamese/English text wrapping by words
                const words = text.split(' ');
                const lines = [];
                let currentLine = '';
                
                for (const word of words) {
                    const testLine = currentLine + (currentLine ? ' ' : '') + word;
                    const metrics = ctx.measureText(testLine);
                    
                    if (metrics.width > maxWidth && currentLine) {
                        lines.push(currentLine);
                        currentLine = word;
                    } else {
                        currentLine = testLine;
                    }
                }
                
                if (currentLine) {
                    lines.push(currentLine);
                }
                
                return lines;
            }
        }
        
        // Test wrapping
        const maxWidth = 400; // Simulate subtitle box width
        const jpLines = wrapText(testData.jp, maxWidth, 11);
        const viLines = wrapText(testData.vi, maxWidth, 10);
        
        console.log('JP Lines:', jpLines);
        console.log('VI Lines:', viLines);
        
        // Display wrapped text
        const jpContainer = document.querySelector('.highlight .jp-text');
        const viContainer = document.querySelector('.highlight .vi-text');
        
        jpContainer.innerHTML = jpLines.join('<br>');
        viContainer.innerHTML = viLines.join('<br>');
    </script>
</body>
</html>
